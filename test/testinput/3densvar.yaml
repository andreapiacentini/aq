variables: &vars
  - CO
  - O_3
  - NO_2
gems02 geometry: &gems02_geom
  nx: 260
  ny: 200
  dx: 0.2
  dy: 0.2
  xmin: -15.9
  ymin:  32.1
  domname: GEMS02
  levels: 5
  model levels: 47
  orientation: up

# Mnemonics:
memo:
  - &state_ref
    date: 2010-07-04T01:00:00Z
    filename: Data/E0001/HMGEMS02+2010070401.nc
    state variables: *vars

cost function:
  cost type: 3D-Var
  window begin: 2010-07-04T00:00:00Z
  window length: PT2H
  analysis variables: *vars
  geometry: *gems02_geom

  background:
    date: 2010-07-04T01:00:00Z
    filename: Data/E0001/HMGEMS02+2010070401.nc
    state variables: *vars

  background error:
    covariance model: ensemble
    localization:
      bump:
        datadir: Data
        load_nicas_local: 1
        prefix: loc_3d
        strategy: common
      localization method: BUMP
      localization variables: *vars
    members:
      - <<: *state_ref
        filename: Data/E0001/HMGEMS02+2010070401.nc
      - <<: *state_ref
        filename: Data/E0002/HMGEMS02+2010070401.nc
      - <<: *state_ref
        filename: Data/E0003/HMGEMS02+2010070401.nc
      - <<: *state_ref
        filename: Data/E0004/HMGEMS02+2010070401.nc
      - <<: *state_ref
        filename: Data/E0005/HMGEMS02+2010070401.nc
      - <<: *state_ref
        filename: Data/E0006/HMGEMS02+2010070401.nc
      - <<: *state_ref
        filename: Data/E0007/HMGEMS02+2010070401.nc
      - <<: *state_ref
        filename: Data/E0008/HMGEMS02+2010070401.nc
      - <<: *state_ref
        filename: Data/E0009/HMGEMS02+2010070401.nc
      - <<: *state_ref
        filename: Data/E0010/HMGEMS02+2010070401.nc

  observations:
  - obs space:
      obsdatain:
        obsfile: Data/HDAT+20100704.h5
      obsdataout:
        obsfile: Data/HSTAT+20100704.h5
      obs type: CO
      instr name: AIRBASE_CO
    obs operator:
      obs type: InSitu
      mod var: CO
#    get values:
#      filename: Data/HGOM+20100704_CO.gom
  - obs space:
      obsdatain:
        obsfile: Data/HDAT+20100704.h5
      obsdataout:
        obsfile: Data/HSTAT+20100704.h5
      obs type: O3
      instr name: AIRBASE_O3
    obs operator:
      obs type: InSitu
      mod var: O_3
#    get values:
#      filename: Data/HGOM+20100704_O3.gom

variational:
  minimizer:
    algorithm: DRIPCG

  iterations:
  - diagnostics:
      departures: ombg
    gradient norm reduction: 1.0e-10
    ninner: 10
    geometry: *gems02_geom
    test: on

final:
  diagnostics:
    departures: oman

output:
  datadir: Data
  fileprefix: A3GEMS02

test:
  reference filename: testoutput/3densvar.test
  test output filename: testoutput/3densvar.log
